module House (rhyme) where

import Data.List (intercalate)

-- Defines the items in the rhyme and their associated actions.
-- Each tuple is (item_name, action_phrase_for_this_item).
-- The action phrase describes what the item *does*.
stanzas :: [(String, String)]
stanzas =
  [ ("house", "that Jack built.")
  , ("malt", "that lay in")
  , ("rat", "that ate")
  , ("cat", "that killed")
  , ("dog", "that worried")
  , ("cow with the crumpled horn", "that tossed")
  , ("maiden all forlorn", "that milked")
  , ("man all tattered and torn", "that kissed")
  , ("priest all shaven and shorn", "that married")
  , ("rooster that crowed in the morn", "that woke")
  , ("farmer sowing his corn", "that kept")
  , ("horse and the hound and the horn", "that belonged to")
  ]

-- Generates the recursive chain of lines for a verse.
-- 'k' is the 0-indexed position in the 'stanzas' list,
-- representing the current item in the chain being built.
buildChain :: Int -> [String]
buildChain k
  -- Base case: When k is 1 (referring to "malt"), generate the final line
  -- "that lay in the house that Jack built."
  | k == 1 = [snd (stanzas !! 1) ++ " the " ++ fst (stanzas !! 0) ++ " " ++ snd (stanzas !! 0)]
  -- Recursive step: Combine the action of the item at index 'k'
  -- with the item at index 'k-1', then recurse for 'k-1'.
  | otherwise =
    let (_, currentAction) = stanzas !! k
        (prevItem, _) = stanzas !! (k-1)
    in (currentAction ++ " the " ++ prevItem) : buildChain (k-1)

-- Generates a single verse of the rhyme.
-- 'n' is the 1-indexed verse number (from 1 to 12).
generateVerse :: Int -> String
generateVerse n = unlines $
  let (currentSubject, currentAction) = stanzas !! (n-1)
      firstLine = "This is the " ++ currentSubject
  in if n == 1
     -- Special case for the first verse: "This is the house that Jack built."
     then [firstLine ++ " " ++ currentAction]
     -- For other verses, combine the first line with the recursive chain.
     else firstLine : buildChain (n-1)

-- The complete rhyme, generated by combining all verses.
rhyme :: String
rhyme = intercalate "\n\n" $ map (init . generateVerse) [1..12]
